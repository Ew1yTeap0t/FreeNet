<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>FreeNet - Direct Connection</title>
    <style>
        :root { --win-bg: #c0c0c0; --win-blue: #000080; }
        body { background: #008080; font-family: 'Tahoma', sans-serif; margin: 0; padding: 20px; }
        .window { width: 800px; background: var(--win-bg); border: 2px solid #fff; border-right: 2px solid #000; border-bottom: 2px solid #000; margin: 0 auto; box-shadow: 4px 4px 10px rgba(0,0,0,0.5); }
        .title-bar { background: linear-gradient(90deg, var(--win-blue), #1084d0); color: white; padding: 4px 8px; font-weight: bold; display: flex; justify-content: space-between; }
        .main-layout { display: flex; gap: 10px; padding: 10px; height: 500px; }
        .sidebar { width: 200px; background: #eee; border: 2px inset #fff; padding: 10px; font-size: 12px; display: flex; flex-direction: column; gap: 10px; }
        .viewport { flex-grow: 1; background: #fff; border: 2px inset #fff; display: flex; flex-direction: column; padding: 10px; }
        #messages { flex-grow: 1; overflow-y: auto; border: 1px inset #ccc; background: white; padding: 10px; font-size: 13px; margin-bottom: 10px; }
        .controls { display: flex; gap: 5px; }
        input { border: 2px inset #fff; padding: 4px; }
        button { background: var(--win-bg); border: 2px outset #fff; cursor: pointer; padding: 4px 10px; font-weight: bold; }
        #status { font-weight: bold; font-size: 11px; }
    </style>
</head>
<body>

<div class="window">
    <div class="title-bar"><span>FreeNet_Direct_v2.exe</span><span>[X]</span></div>
    <div class="main-layout">
        <div class="sidebar">
            <strong>Профиль:</strong>
            <input type="text" id="nick" placeholder="Ник" value="User">
            <input type="text" id="ava-url" placeholder="Ава URL" value="https://via.placeholder.com/20">
            <hr style="width: 100%">
            <div id="status" style="color: orange;">• ПОДКЛЮЧЕНИЕ...</div>
            <div style="font-size: 10px; color: #666;">Система: WebSocket Native</div>
        </div>
        <div class="viewport">
            <div id="messages"></div>
            <div class="controls">
                <input type="text" id="msg-input" style="flex-grow: 1;" placeholder="Сообщение..." onkeypress="if(event.key==='Enter') sendMsg()">
                <button onclick="sendMsg()">ОТПРАВИТЬ</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ПРЯМОЙ АДРЕС СЕРВЕРА (БЕЗ БИБЛИОТЕК)
    const clusterId = 'free.blr2';
    const apiKey = '0iYPnJ73GIaHA4RqdncbL65VJjQcjXxBidYb8K6B';
    const wsUrl = `wss://${clusterId}.piesocket.com/v3/freenet-room?api_key=${apiKey}&notify_self=1`;

    let socket;

    function connect() {
        socket = new WebSocket(wsUrl);

        socket.onopen = () => {
            document.getElementById('status').innerText = "• В СЕТИ";
            document.getElementById('status').style.color = "green";
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const box = document.getElementById('messages');
            const msg = document.createElement('div');
            msg.style.marginBottom = '5px';
            msg.innerHTML = `<img src="${data.ava}" width="18" style="vertical-align:middle"> <b>${data.nick}:</b> ${data.msg}`;
            box.appendChild(msg);
            box.scrollTop = box.scrollHeight;
        };

        socket.onclose = () => {
            document.getElementById('status').innerText = "• СОЕДИНЕНИЕ ПОТЕРЯНО";
            document.getElementById('status').style.color = "red";
            setTimeout(connect, 3000); // Автопереподключение
        };
    }

    function sendMsg() {
        const input = document.getElementById('msg-input');
        if (socket.readyState === WebSocket.OPEN && input.value.trim() !== "") {
            const payload = {
                nick: document.getElementById('nick').value,
                msg: input.value,
                ava: document.getElementById('ava-url').value
            };
            socket.send(JSON.stringify(payload));
            input.value = "";
        }
    }

    connect();
</script>
</body>
</html>
